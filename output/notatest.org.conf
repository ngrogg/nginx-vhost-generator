# HTTP Section
server {
    ## Listen on HTTP port
    listen 80;
    listen [::]:80;

    ## Domain
    server_name notatest.org www.notatest.org;

    ## Redirect to HTTPS, use 302 for SEO
    return 302 https://$host$request_uri;
}

# HTTPS Section
server {
    ## Listen on HTTPS port
    listen 443 ssl;
    listen [::]:443 ssl;

    ## Domain
    server_name notatest.org www.notatest.org;

    ## Logging
    access_log /var/log/nginx/notatest.org.access.log;
    error_log  /var/log/nginx/notatest.org.error.log error;

    ## SSL Configurations
    ### SSL Protocols to use
    ssl_protocols TLSv1.2 TLSv1.3;

    #TODO: Update ciphers as needed
    ### SSL Ciphers to allow/deny
    ssl_ciphers "ECDH+AESGCM:ECDH+CHACHA20:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:RSA+AESGCM:RSA+AES:!aNULL:!MD5:!DSS";

    #TODO: Replace with proper SSL filepath
    ### SSL Cert and Key
    ssl_certificate /path/to/cert;
    ssl_certificate_key /path/to/key;

    #TODO: Adjust docroot filepath as needed
    ## Docroot
    root /var/www/notatest.org;

    TODO: Adjust index as needed
    ## Docroot Index
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    ## Disable symlink handling
    disable_symlinks on;

    ## Hide nginx version
    server_tokens off;

    TODO: Adjust as needed
    ## Handle PHP requests
    location ~ \.php$ {
        include fastcgi_params;
        ### With php-fpm, adjust as needed
        fastcgi_pass /run/php-fpm/www.sock;
    }

    #TODO: Expand/adjust as needed
    ## Filepath Blocks
    ### Block access to xmlrpc.php
    location /xmlrpc.php {
        deny all;
        return 403;
    }

    ### Deny access to backup/config files
    location ~* \.(bak|config|sql|fla|psd|ini|log|sh|inc|swp|dist|gz|bz|dump|zip|gzip)$ {
        deny all;
        return 403;
    }
}
